## Использование

***Данный раздел руководства находится в стадии разработки.***

Получаемый после сборки исполняемый файл использует интерфейс командной строки.

```
kkmha.exe команда [аргумент ...]
kkmop.exe команда аргумент ...
kkmjl.exe {сн} {вф}
```

| КОМАНДА              | ОПИСАНИЕ                                                   |
|----------------------|------------------------------------------------------------|
| help                 | Вывести справку. _(ha+op)_                                 |
| show-config          | Вывести конфигурацию. _(ha+op)_                            |
| install              | Установить сервер как службу Windows.                      |
| uninstall            | Удалить службу Windows.                                    |
| start                | Запустить службу.                                          |
| stop                 | Остановить службу.                                         |
| restart              | Перезапустить службу.                                      |
| foreground           | Запустить сервер как foreground-процесс.                   |
| learn _{пп}_ ...     | Добавить ККМ. _(op)_                                       |
| status _{сн}_        | Вывести статус ККМ. _(op)_                                 |
| demo-print _{сн}_    | Выполнить демо-печать. _(op)_                              |
| ofd-test _{сн}_      | Тестировать подключение ККМ к ОФД. _(op)_                  |
| shift-reports _{сн}_ | Напечатать нераспечатанные отчеты о закрытии смены. _(op)_ |
| last-document _{сн}_ | Напечатать копию последнего документа. _(op)_              |
| report-x _{сн}_      | Печать Х-отчёта ККМ. _(op)_                                |
| close-shift _{сн}_   | Закрыть смену ККМ. _(op)_                                  |
| reset-state _{сн}_   | Возврат ККМ к исходному состоянию. _(op)_                  |
| exec _{сн}_ _{вф}_   | Выполнить операцию описанную в файле. _(jl) (json)_        |

где

| АРГУМЕНТ | ОПИСАНИЕ                                        |
|----------|-------------------------------------------------|
| _{пп}_   | Параметры подключения. Можно указать несколько. |
| _{сн}_   | Серийный номер ККМ.                             |
| _{вф}_   | Входной файл в JSON-формате.                    |

| СНОСКА    | ОПИСАНИЕ                                                                                                               |
|-----------|------------------------------------------------------------------------------------------------------------------------|
| _(ha+op)_ | Команда реализована и в `kkmha.exe` и в `kkmop.exe`.                                                                   |
| _(op)_    | Если проект собран с опцией `-D BUILD_SEPARATED=ON`, команда выполняется приложением `kkmop.exe`.                      |
| _(jl)_    | Если проект собран с опцией `-D BUILD_SEPARATED=ON`, команда выполняется приложением `kkmjl.exe` без аргумента `exec`. |
| _(json)_  | Вывод в JSON-формате.                                                                                                  |

***Для идентификации ККМ подключенной к компьютеру как в командной строке, так и в API используется её серийный номер.***

Параметры подключения имеют следующий формат `тип,аргумент1,аргумент2,...,аргументN`, где `тип` - это протокол или
интерфейс подключения ККМ. В данный момент реализован подключения только по COM-порту (тип `"com"`) (в том числе
виртуальному, т.е. подключение через USB). Аргументы для данного типа подключения:
- аргумент1 - номер COM-порта;
- аргумент2 - скорость COM-порта. Если данный аргумент опущен, то используется значение из конфигурационного файла
  `kkm.defaultBaudRate`. Если же и в конфигурационном файле это значение не задано, то используется 115200.

Так же зарезервированы, но не реализованы следующие протоколы и интерфейсы: `"usb"`, `"tcpip"` (`"ip"`), `"bluetooth"`
(`"bt"`).

Для `kkmha.exe exec` и `kkmjl.exe` вместо серийного номера можно использовать "`-`" для команды `learn`
(`"!query": "learn"`), "`+`" для указания того, что серийный номер должен быть считан из файла запроса. 

Примеры:
```cmd
kkmha.exe install
kkmha.exe start
kkmha.exe foreground

kkmha.exe learn com,4 com,6
kkmop.exe learn com,4 com,6

kkmha.exe status 98765433456789
kkmop.exe status 98765433456789

kkmha.exe close-shift 98765433456789
kkmop.exe close-shift 98765433456789

kkmha.exe exec - ../examples/json/learn.json
kkmjl.exe - ../examples/json/learn.json

kkmha.exe exec + ../examples/json/status.json
kkmjl.exe + ../examples/json/status.json

kkmha.exe exec 98765433456789 ../examples/json/status.json
kkmjl.exe 98765433456789 ../examples/json/status.json
```

---
[Назад к содержанию](../README.md)
